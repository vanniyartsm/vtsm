<% var DATE_FORMAT = 'YYYY-MM-DD hh:mm:ss A' %>
<% var moment = locals.moment; %>
<div class="utils__content">

  <!-- START: ecommerce/cart-checkout -->
  <div class="card">
    <div class="card-header">
      <span class="utils__title">
        <strong>Purchase Points</strong>
      </span>
    </div>
    <div class="card-body">
      <div class="row">
        <div class="col-lg-12">
            <div class="mb-5">
                <div class="nav-tabs-horizontal">
                    <ul class="nav nav-tabs mb-4" role="tablist">
                        <li class="nav-item">
                            <a class="nav-link active" href="javascript: void(0);" data-toggle="tab" data-target="#home1" role="tab">Purchase</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="javascript: void(0);" data-toggle="tab" data-target="#profile1" role="tab">History</a>
                        </li>
                    </ul>
                    <div class="infoCard infoCard--whiteFont bg-success"><strong>AVAILABLE POINTS : </strong><label class="white" id="available">$<%= (locals.balance) ? locals.balance.available : 0 %></label></div>

                    <div class="tab-content">
                        <div class="tab-pane active" id="home1">
                          <p style="display:none;">
                            <label>Theme:</label>
                            <select id="theme_selector">
                              <option value="default">Default</option>
                              <option value="arrows" selected>Arrows</option>
                              <option value="dots">Dots</option>
                              <option value="progress">Progress</option>
                            </select>
                      
                            &nbsp;&nbsp;
                            <input type="checkbox" id="is_justified" value="1" checked />
                            <label for="is_justified">Justified</label>
                      
                            <input type="checkbox" id="dark_mode" value="1" />
                            <label for="dark_mode">Dark Mode</label>
                      
                            &nbsp;&nbsp;
                            <label>Animation:</label>
                            <select id="animation">
                                  <option value="none">None</option>
                                  <option value="fade">Fade</option>
                                  <option value="slide-horizontal" selected>Slide Horizontal</option>
                                  <option value="slide-vertical">Slide Vertical</option>
                                  <option value="slide-swing">Slide Swing</option>
                            </select>
                      
                            &nbsp;&nbsp;
                            <label>Go To:</label>
                            <select id="got_to_step">
                                  <option value="1">1</option>
                                  <option value="2">2</option>
                                  <option value="3">3</option>
                                  <option value="4">4</option>
                            </select>
                      
                            <br />
                            <label>External Buttons:</label>
                            <button class="btn btn-secondary" id="prev-btn" type="button">Go Previous</button>
                            <button class="btn btn-secondary" id="next-btn" type="button">Go Next</button>
                            <button class="btn btn-danger" id="reset-btn" type="button">Reset Wizard</button>
                          </p>
                          <br />
                      
                      
                          <!-- SmartWizard html -->
                          <div id="smartwizard">
                      
                              <ul class="nav">
                                  <li class="nav-item">
                                    <a class="nav-link" href="#step-1">
                                      <strong>Points</strong> <br>Provide points to purchase
                                    </a>
                                  </li>
                                  <li class="nav-item">
                                    <a class="nav-link" href="#step-2">
                                      <strong>Deposit Info</strong> <br>Crypto deposit information
                                    </a>
                                  </li>
                              </ul>
                      
                              <div class="tab-content">
                                <form id="purchase-points-form" class="form form-horizontal form-bordered bb-form"
                                    method="POST" action="/web/points/update" data-url="/web/points/update" data-title="Deposit Bitcoin"
                                    data-method="POST" data-form="true" name="buy-elc-form" data-message="true">
                                    <div id="step-1" class="tab-pane" role="tabpanel" aria-labelledby="step-1">
                                      <section>
                                        <div>
                                          <div class="card" data-order-id="card-3">
                                            <div class="card-header card-header-bg">
                                              <input type="hidden" id="btcFinalBalance" name="btcFinalBalance" />
                                              <input type="hidden" id="hash" name="hash" />
                                              <input type="hidden" id="blockchain-initiated-id" name="id" />
                                              <input type="hidden" id="bitcoin-address" class="form-control" placeholder="Bitcoin Address"
                                                aria-describedby="bitcoin-address" value="<%= user.btcwallet %>" readonly>
                                              <input type="hidden" id="cryptoType" name="cryptoType" value="bitcoin" />
                                              <input type="hidden" class="btn btn-primary mr-1" id="user-information"  data-username="<%= user.userName %>" data-userid="<%= user._id %>" data-btcwallet="<%= user.btcwallet %>"  data-context="<%= locals.context %>">
                                              
                                              <div class="utils__title">
                                                  <strong>Required Points : <input type="number" id="purchase-points"
                                                    class="form-control square" placeholder="points" name="points" style="width:100%;"
                                                    class="required">&nbsp;</strong></div>
                                              <input type="hidden" id="buy-usd" class="form-control square" placeholder="USD" name="usd" readonly>
                                              <input type="hidden" id="buy-bitcoin" class="form-control square" placeholder="Bitcoin"
                                                name="bitcoin" readonly>
                                            </div>
                                            <div class="card-body">
                                              <div class="row">
                                                <div class="col-xl-4">
                          
                                                  <div class="userCard px-2 py-2 userCard--whiteFont bg-success" id="bitcoin">
                                                    <div class="row">
                                                      <div class="col-xl-4">
                                                        <a class="d-block mx-auto avatar avatar--40" style="margin-top: 10px;"
                                                          href="javascript: void(0);">
                                                          <img src="<%= locals.context %>/inner/assets/images/crypto/bitcoin.jpg"
                                                            alt="Alternative text to the image">
                                                        </a>
                                                      </div>
                                                      <div class="col-xl-8">
                                                        <div class="text-center">
                                                          <div class="userCard__userName font-size-18">Bitcoin</div>
                                                        </div>
                                                        <div class="text-center">
                                                          <div class="btn-group text-center">
                                                            <button type="button" class="btn btn-sm btn-rounded crypto-type" data-type="bitcoin" id="bitcoin-btn">Selected</button>
                                                          </div>
                                                        </div>
                                                      </div>
                                                    </div>
                                                  </div>
                                                </div>
                          
                                                <div class="col-xl-4">
                                                  <div class="userCard px-2 py-2" id="usdt">
                                                    <div class="row">
                                                      <div class="col-xl-4">
                                                        <a class="d-block mx-auto avatar avatar--40" style="margin-top: 10px;"
                                                          href="javascript: void(0);">
                                                          <img src="<%= locals.context %>/inner/assets/images/crypto/usdt.jpg"
                                                            alt="Alternative text to the image">
                                                        </a>
                                                      </div>
                                                      <div class="col-xl-8">
                                                        <div class="text-center">
                                                          <div class="userCard__userName font-size-18">USDT</div>
                                                        </div>
                                                        <div class="text-center">
                                                          <div class="btn-group text-center">
                                                            <button type="button" class="btn btn-sm btn-rounded crypto-type"  data-type="usdt" id="usdt-btn">Select</button>
                                                          </div>
                                                        </div>
                                                      </div>
                                                    </div>
                                                  </div>
                                                </div>
                          
                          
                                                <div class="col-xl-4">
                                                  <div class="userCard px-2 py-2"  id="ethereum">
                                                    <div class="row">
                                                      <div class="col-xl-4">
                                                        <a class="d-block mx-auto avatar avatar--40" style="margin-top: 10px;"
                                                          href="javascript: void(0);">
                                                          <img src="<%= locals.context %>/inner/assets/images/crypto/ethereum.jpg"
                                                            alt="Alternative text to the image">
                                                        </a>
                                                      </div>
                                                      <div class="col-xl-8">
                                                        <div class="text-center">
                                                          <div class="userCard__userName font-size-18">Ethereum</div>
                                                        </div>
                                                        <div class="text-center">
                                                          <div class="btn-group text-center">
                                                            <button type="button" class="btn btn-sm btn-rounded crypto-type" data-type="ethereum" id="ethereum-btn">Select</button>
                                                          </div>
                                                        </div>
                                                      </div>
                                                    </div>
                                                  </div>
                                                </div>
                          
                                              </div>
                                              <div class="utils__margin-fix">
                                                <!-- -->
                                              </div>
                                            </div>
                                          </div>
                                        </div>
                          
                                      </section>
                                        
                                    </div>
                                    <div id="step-2" class="tab-pane" role="tabpanel" aria-labelledby="step-2">
                                      <section id="secondStep" style="display:none;">
                                        <div class="row">
                                          <div class="col-md-6">
                                            <div style="padding: 0px 40px 20px 40px; background: #fff;">
                                              <table style="border-collapse: collapse; border: 0; width: 100%;">
                                                <tbody>
                                                  <tr>
                                                    <td>
                                                      <!-- <h2 style="margin-bottom: 20px; color: #24222f; font-weight: 600">Thanks for Purchase! -->
                                                      </h2>
                                                      <!-- <p>
                                                        <span style="color: #a09bb9">Monday, Dec 28 2015 at 4:13 PM</span>
                                                      </p> -->
                                                      <br />
                                                      <h5 style="margin-bottom: 20px; color: #24222f; font-weight: 600"><span id="deposit-crypto"> </span>Deposit Details
                                                      </h5>
                                                      <table style="border-collapse: collapse; border: 0; width: 100%;">
                                                        <!-- <tr>
                                                          <td
                                                            style="text-align: left; padding: 10px 10px 10px 0px; border-top: 3px solid #514d6a;">
                                                            Pay from
                                                          </td>
                                                          <td
                                                            style="width: 20%; text-align: right; padding: 10px 0px 10px 10px; white-space: nowrap; border-top: 3px solid #514d6a;">
                                                            <a class="d-block mx-auto avatar avatar--30" href="javascript: void(0);">
                                                              <img src="<%= locals.context %>/inner/assets/images/crypto/bitcoin.jpg"
                                                                alt="Alternative text to the image">
                                                            </a>
                                                          </td>
                                                        </tr> -->
                                                        <tr>
                                                          <td
                                                            style="text-align: left; padding: 10px 10px 10px 0px; border-top: 1px solid #d9d7e0;">
                                                            Requested Points
                                                          </td>
                                                          <td
                                                            style="width: 20%; text-align: right; padding: 10px 0px 10px 10px; white-space: nowrap; border-top: 1px solid #d9d7e0;"><strong><span class="text-success" id="requested-points">$0</span></strong>
                                                          </td>
                                                        </tr>
                                                        <tr>
                                                          <td
                                                            style="text-align: left; padding: 10px 10px 10px 0px; border-top: 1px solid #d9d7e0;">
                                                            <span id="crypto-value"></span> Value
                                                          </td>
                                                          <td
                                                            style="width: 20%; text-align: right; padding: 10px 0px 10px 10px; white-space: nowrap; border-top: 1px solid #d9d7e0;"><strong><span class="text-warning" id="calculated-bitcoin-value">0</span></strong>
                                                          </td>
                                                        </tr>
                                                        <!-- <tr>
                                                          <td
                                                            style="text-align: center; padding: 10px 10px 10px 0px; border-top: 3px solid #514d6a;" colspan="2">
                                                            <span style="font-size: 18px; font-weight: bold"><div id="bitcoinQRcode" class="qrcode">&nbsp;</div></span>
                                                          </td>
                                                        </tr> -->
                                                      </table>
                                                    </td>
                                                  </tr>
                                                </tbody>
                                              </table>
                                            </div>
                                          </div>
                                          
                                          <div class="col-md-6">
                                            <div style="width: 100%; background: #eceff4; padding: 50px 20px; color: #514d6a;">
                                              <div style="max-width: 700px; margin: 0px auto; font-size: 14px">
                                                <div style="padding: 40px 40px 20px 40px; background: #fff;">
                                                  <table style="border-collapse: collapse; border: 0; width: 100%;">
                                                    <tbody>
                                                      <tr>
                                                        <td colspan="2">
                                                          <h5 class="text-danger">Important</h5>
                                                        </td>
                                                      </tr>
                                                      <tr id="btc-wrapper" style="display: none;">
                                                        <td>
                                                          <input type="text" class="form-control" id="btc-wallet-address"
                                                            value="<%= user.btcwallet %>" readonly>
                                                        </td>
                                                        <td width="20%">
                                                          <button id="copy-btc-address" class="ml-3 btn btn-outline-default btn-sm">Copy
                                                            Address</button>
                                                        </td>
                                                        </td>
                                                      </tr>
                                                      <tr id="bitcoin-content">
                                                        <td colspan="2">
                                                          <h3>Send Bitcoin only .</h3>
                                                          <ul>
                                                            <li>Sending other than Bitcon to the address mentioned may result in the loss of your deposit.</li>
                                                            <li>Points will be deposited instantly once recieved blockchain confirmation.</li>
                                                            <li>Copy and paste the address to your wallet or scan the QR code via your wallet app</li>
                                                            <li>Incase of timelapse after you sent Bitcoin, You can make request under Purchase Points -> History section</li>
                                                          </ul>
                                                        </td>
                                                      </tr>

                                                      <tr id="usdt-content" style="display:none;">
                                                        <td colspan="2">
                                                          <h3>Send USDT only.</h3>
                                                          <ul>
                                                            <li>Sending other than USDT to the address mentioned may result in the loss of your deposit.</li>
                                                            <li>Points will be deposited within 12 hours after blockchain confirmation.</li>
                                                            <li>Copy and paste the address to your wallet or scan the QR code via your wallet app</li>
                                                          </ul>
                                                        </td>
                                                      </tr>

                                                      <tr id="ethereum-content" style="display:none;">
                                                        <td colspan="2">
                                                          <h3>Send Ethereum only.</h3>
                                                          <ul>
                                                            <li>Sending other than Ethereum to this address mentioned may result in the loss of your deposit.</li>
                                                            <li>Points will be deposited within 12 hours after blockchain confirmation.</li>
                                                            <li>Copy and paste the address to your wallet or scan the QR code via your wallet app</li>
                                                          </ul>
                                                        </td>
                                                      </tr>
                                                    </tbody>
                                                  </table>
                                                </div>
                                              </div>
                                            </div>
                                          </div>
                                        </div>
                                      </section>
                                    </div>
                              </div>
                          </div>
                      
                        </div>
                        <div class="tab-pane" id="profile1">
                          
                                <div id="blockchainIntiated" class="dataTables_wrapper dt-bootstrap4">
                                    <div class="row">
                                      <div class="col-xl-12">
                                          <table class="table table-hover nowrap dataTable dtr-inline"
                                              id="blockchainIntiatedTbl" role="grid"
                                              aria-describedby="example1_info">
                                              <thead class="thead-default">
                                                  <tr role="row">
                                                      <th>S. No.</th>
                                                      <th>Date</th>
                                                      <th>Points</th>
                                                      <th>BTC</th>
                                                      <th>Status</th>
                                                      <th>Comments</th>
                                                      <th>Transaction Id</th>
                                                      <th>Action</th>
                                                  </tr>
                                              </thead>
                                              <tbody>
                                                  <% 
                                                  if (locals.blockchainInitiatedList) {
                                                  for(var i=0; i < locals.blockchainInitiatedList.length; i++) {
                                                    var bi = locals.blockchainInitiatedList[i];
                                                %>

                                                  <tr role="row" class="odd">
                                                      <td tabindex="0" class="sorting_1"><%= (i + 1) %></td>
                                                      <td><a href="javascript: void(0);"
                                                              class="link-underlined"><%= moment(bi.depositedDate).format(DATE_FORMAT) %></a>
                                                      </td>
                                                      <td>
                                                        <%= '$' + bi.points.value %></td>
                                                      <td><%= (bi.value != null) ? JSON.stringify(bi.value) : '-' %></td>
                                                      <td id="request-status">
                                                        <% if (bi.rejected) { %>
                                                            <a href="javascript:void(0);" class="btn btn-danger btn-sm">
                                                              REJECTED
                                                            </a>
                                                        <%  } else if (bi.Approved) { %>
                                                            <a href="javascript:void(0);" class="btn btn-success btn-sm">
                                                              APPROVED & DEPOSITED
                                                            </a>
                                                        <% } else if (bi.deposited) { %>
                                                          <a href="javascript:void(0);" class="btn btn-success btn-sm">
                                                              DEPOSITED
                                                          </a>
                                                        <% } else if (bi.requested) { %>
                                                            <a href="javascript:void(0);" class="btn btn-warning btn-sm">
                                                                REQUESTED
                                                            </a>
                                                        <% } else if (bi.initiated) { %>
                                                            <a href="javascript:void(0);" class="btn btn-info btn-sm">
                                                                INITIATED
                                                            </a>
                                                        <% } %>
                                                            </td>
                                                      <td><%= bi.comments %></td>
                                                      <td><%= bi._id %></td>
                                                      <td id="request-initiated">
                                                          <% if (bi.initiated && !bi.requested && !bi.deposited) { %>
                                                            <button class="btn btn-primary btn-sm request-btn" data-id="<%= bi._id %>">Request</button>
                                                          <% } else { %>
                                                              -
                                                          <% } %>
                                                      </td>
                                                  </tr>
                                                  <% } 
                                                }%>
                                              </tbody>
                                          </table>
                                      </div>
                                  </div>
                                </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
      
    </div>
  </div>
  <!-- END: ecommerce/cart-checkout -->
  <!-- Include jQuery -->
<!-- CSS -->

<!-- JavaScript -->
<script src="https://cdn.jsdelivr.net/npm/smartwizard@5/dist/js/jquery.smartWizard.min.js" type="text/javascript"></script>
  <!-- START: page scripts -->
  <script type="text/javascript">
    $(document).ready(function(){
      var context = $('#user-information').data('context');
        var loading = context + "/inner/assets/images/loading.gif"
        var types = ['bitcoin', 'usdt', 'ethereum'];
        //var ethWallet = "0x8f567486d0D55741152F61A241B4e63348509537";
        var ethWallet = "0x8468ec253f30293aecf69ecfdab435505cc03b45";
        var usdtWallet = "0x7813e354b03cec3457f724977f19fb3636830d16";
        $(document.body).on('click', '.crypto-type', function () {
          
          var type = $(this).data("type");
          

          for (var i = 0; i < types.length; i++) {
              if (type == types[i]) {
                $('#' + type).addClass('userCard--whiteFont bg-success');
                $('#' + types[i] + '-btn').html('Selected');
                $('#cryptoType').val(type);
                var key = '#' + types[i] + '-content';
                $(key).show();
              } else {
                $('#' + types[i]).removeClass('userCard--whiteFont bg-success');
                $('#' + types[i] + '-btn').html('Select');
                var key = '#' + types[i] + '-content';
                $(key).hide();
              }
          }
        });

        // Toolbar extra buttons
        var btnFinish = $('<button></button>').text('Finish')
                                         .addClass('btn btn-info finish-btn')
                                         .on('click', function(){ 
                                           var isFinishDisabled = $(this).hasClass( "disabled");
                                           var cryptoType = $('#cryptoType').val();
                                           if (!isFinishDisabled) {
                                            swal({
                                                title: "Are you sure?",
                                                text: "Confirm, to initiate the " + cryptoType + " process",
                                                type: "warning",
                                                showCancelButton: true,
                                                confirmButtonClass: "btn-danger",
                                                confirmButtonText: "Yes, confirm!",
                                                cancelButtonText: "No, cancel pls!",
                                                closeOnConfirm: false,
                                                closeOnCancel: false
                                              },
                                              function(isConfirm) {
                                                if (isConfirm) {
                                                  //initiateBitcoin();
                                                  var btcWallet = $('#user-information').data("btcwallet");
                                                  var walletAddress = btcWallet;
                                                  var wType = "BTC";
                                                  var btcDeposit = JSON.parse(initiateBitcoinDeposit(cryptoType));
                                                  console.info('btcDeposit = ', btcDeposit);
                                                  var panel = "";
                                                  if (btcDeposit.data) {
                                                    $('#blockchain-initiated-id').val(btcDeposit.data._id);
                                                    var btcValue = $('#buy-bitcoin').val();

                                                  if (cryptoType == 'bitcoin') {
                                                      var btcs = new WebSocket('wss://ws.blockchain.info/inv');
                                                      panel = getBitcoinPanel(btcDeposit, btcWallet, btcValue);
                                                      //$('#dynamic-qr-code').qrcode({width: 150, height: 150, text: btcWallet});
                                                      btcs.onopen = function() {
                                                    //console.info('block chain sent address');
                                                      btcs.send( JSON.stringify( {"op":"addr_sub", "addr": btcWallet} ) );
                                                      }

                                                      btcs.onmessage = function(onmsg) {
                                                          var response = JSON.parse(onmsg.data);
                                                          var getOuts = response.x.out;
                                                          var countOuts = getOuts.length; 
                                                          for(var i = 0; i < countOuts; i++) {
                                                            //check every output to see if it matches specified address
                                                            var outAdd = response.x.out[i].addr;
                                                            $('#hash').val(response.x.hash);
                                                            var specAdd = btcWallet;
                                                              if (outAdd == specAdd ) {
                                                                var amount = response.x.out[i].value;
                                                                var calAmount = amount / 100000000;
                                                                var bitcoinValue = $('#buy-bitcoin').val();
                                                                if (calAmount == bitcoinValue) {
                                                                  $('#messages').prepend("Received " + calAmount + " BTC");
                                                                  $('#purchase-points-form').submit();
                                                                  swal("Congratulation! Exchange Completed", "You will see your points in your Trade wallet, Thank you for using Quberos Automic Swap service.", "success");
                                                                    //$("#buy-units").trigger("click");
                                                                    //location.href = '/web/points/buy';
                                                                }
                                                              }
                                                          } 
                                                        }
                                                  } else if (cryptoType == 'ethereum' || cryptoType == 'usdt') {
                                                      panel = getCryptoPanel(btcDeposit, btcWallet, btcValue, cryptoType);
                                                      if (cryptoType == 'ethereum') {
                                                        walletAddress = ethWallet;
                                                        wType = "ETH";
                                                      } else if (cryptoType == 'usdt') {
                                                          walletAddress = usdtWallet;
                                                          wType = "USDT";
                                                      }
                                                      
                                                  }
                                                    swal({
                                                      'title' : '<strong>' + wType + ' Transaction Initiated</strong>',
                                                      icon: 'info',
                                                      //imageUrl: loading,
                                                      html: true,
                                                      text: panel,
                                                      showConfirmButton: false
                                                    });

                                                    $('#dynamic-qr-code').qrcode({width: 150, height: 150, text: walletAddress});
                                                    /*setTimeout(function() {
                                                      $('#hash').val('2138172381238172873128');
                                                        var specAdd = "1PjmVHWtcNnaZ2AtgoEfJtEMTYEp1bv2tZ";
                                                        var amount = 0.111;
                                                        var calAmount = amount / 100000000;
                                                        var bitcoinValue = 0.111;
                                                        //if (calAmount == bitcoinValue) {
                                                          $('#messages').prepend("Received " + calAmount + " BTC");
                                                          //console.info('purchase-points-form submit');
                                                          $('#purchase-points-form').submit();
                                                          swal("Congratulation! Exchange Completed", "You will see your points in your Trade wallet, Thank you for using Quberos Automic Swap service.", "success");
                                                          //$("#buy-units").trigger("click");
                                                          //location.href = '/web/points/buy';
                                                      //}
                                                  }, 3000);*/
                                                    
                                                  //$("a[href$='previous']").hide();
                                                  //$("a[href$='finish']").hide();
                                                  //swal("Initiated!", "Deposit Initiated.", "success");
                                                  } else {
                                                    swal("Cancelled", "Value or Points should not be empty", "error");  
                                                  }
                                                } else {
                                                  swal("Cancelled", "Your BTC initiation process cancelled", "error");
                                                }
                                              });
                                            }

                                         });
        var btnCancel = $('<button id="finish-btn"></button>').text('Cancel')
                                         .addClass('btn btn-danger')
                                         .on('click', function(){ $('#smartwizard').smartWizard("reset"); });

        var btnNext = $('<button></button>').text('Next')
                                         .addClass('btn btn-danger')
                                         .on('click', function(){ alert('next') });

        // Step show event
        $("#smartwizard").on("showStep", function(e, anchorObject, stepNumber, stepDirection, stepPosition) {
            $("#prev-btn").removeClass('disabled');
            $("#next-btn").removeClass('disabled');

            if(stepPosition === 'first') {
                $("#prev-btn").addClass('disabled');
                $(".finish-btn").addClass('disabled');
            } else if(stepPosition === 'last') {
                var next = processNext();
                if (next) {
                  $("#next-btn").addClass('disabled');
                  $(".finish-btn").removeClass('disabled');
                } else {
                  $('#smartwizard').smartWizard("reset");
                }
            } else {
                $("#prev-btn").removeClass('disabled');
                $("#next-btn").removeClass('disabled');
            }
        });

        // Smart Wizard
        $('#smartwizard').smartWizard({
            selected: 0,
            theme: 'arrows',
            transition: {
                animation: 'slide-horizontal', // Effect on navigation, none/fade/slide-horizontal/slide-vertical/slide-swing
            },
            toolbarSettings: {
                toolbarPosition: 'both', // both bottom
                toolbarExtraButtons: [btnFinish, btnCancel]
            }
        });

        // External Button Events
        $(document.body).on('click', '#reset-btn', function (e) {
            // Reset wizard
            $('#smartwizard').smartWizard("reset");
            return true;
        });

        $(document.body).on('click', '#prev-btn', function (e) {
            // Navigate previous
            $('#smartwizard').smartWizard("prev");
            return true;
        });

        $(document.body).on('click', '#next-btn', function (e) {
            // Navigate previous
            $('#smartwizard').smartWizard("next");
            return true;
        });


        $(document.body).on('click', '#crypto-submit', function (e) {

          var hash = $('#crypto-txn-id').val();

          if (hash) {
              $('#hash').val(hash);
              $('#purchase-points-form').submit();
              swal("Successfully! Sumitted Request", "You will see your points in your Trade wallet, Thank you for using Quberos service.", "success");
          } else {
            $('#txn-id-err-msg').addClass("alert alert-danger");
            $('#txn-id-err-msg').html("Please provide transaction id");
          }
        });
        function getBitcoinPanel(deposit, wallet, value) {
          return '<div style="padding: 10px 10px 10px 10px; background: #fff;">' +
                    '<table style="border-collapse: collapse; border: 0; width: 100%;">' +
                    //'<td width="20%"><button id="copy-btc-address" class="ml-3 btn btn-outline-default btn-sm">Copy Address</button></td>' +
                    //'</tr><tr>' +
                      '<tr><td colspan="2"><span style="margin-bottom: 20px; color: #24222f; font-weight: 600;"><strong>Transaction Id : ' + deposit.data._id + '</strong><span></td></tr>' +
                      '<tr><td><span id="dynamic-qr-code"></span></td><td><img src="' + loading + '" width="200" height="200"/></td></tr>' +
                      '<tr><td colspan="2"><span style="margin-bottom: 20px; color: #24222f; font-weight: 600;">Bitcoin Address</span></td></tr>' +
                      '<tr id="btc-wrapper"><td colspan="2"><input type="text" class="form-control" id="btc-wallet-address" value="' + wallet + '" readonly></td></tr>' +
                      '<tr><td colspan="2"><span style="margin-bottom: 20px; color: #24222f; font-weight: 600;">Bitcoin Value : <span class="text-primary">' + value + '<span></span></td></tr>' +
                      '<tr><td colspan="2"><span style="margin-bottom: 10px; color: #24222f; font-weight: 300;"><span class="text-danger">Please copy the above bitcoin address or scan the qrcode and send the exact Bitcoin Value<span></span></td></tr>' +
                    '</table></div>'
        }

        function getCryptoPanel(deposit, wallet, value, type) {
          wallet = (type == 'ethereum') ? ethWallet : usdtWallet;
          var panel = '<div style="padding: 10px 10px 10px 10px; background: #fff;">' +
                    '<table style="border-collapse: collapse; border: 0; width: 100%;">' +
                    //'<td width="20%"><button id="copy-btc-address" class="ml-3 btn btn-outline-default btn-sm">Copy Address</button></td>' +
                    //'</tr><tr>' +
                      '<tr><td colspan="2"><span style="margin-bottom: 20px; color: #24222f; font-weight: 600;"><strong>Process Id : ' + deposit.data._id + '</strong><span></td></tr>' +
                      '<tr><td><span id="dynamic-qr-code"></span></td><td><img src="' + loading + '" width="200" height="200"/></td></tr>' +
                      '<tr><td colspan="2"><span style="margin-bottom: 20px; color: #24222f; font-weight: 600;"> ERC20 Address</span></td></tr>' +
                      '<tr id="btc-wrapper"><td colspan="2"><input type="text" class="form-control" id="btc-wallet-address" value="' + wallet + '" readonly></td></tr>' +
                      '<tr><td colspan="2"><span style="margin-bottom: 20px; color: #24222f; font-weight: 600;"> Value : <span class="text-primary">' + value + '<span></span></td></tr>' +
                      '<tr><td colspan="2"><span style="margin-bottom: 20px; color: #24222f; font-weight: 600;"> Enter your Txn Id * : <span class="text-primary"><input type="text" id="crypto-txn-id" name="crypto-txn-id" required><span></span><div id="txn-id-err-msg" class=""></div></td></tr>' +
                      '<tr><td colspan="2"><span style="margin-bottom: 10px; color: #24222f; font-weight: 300;"><span class="text-danger">Please copy the above address or scan the qrcode and send the exact value. Once sent get the txn id and paste it above the submit request<span></span></td></tr>' +
                      '<tr id="btc-wrapper"><td colspan="2"><input type="button" class="btn btn-success" id="crypto-submit" value="Submit Request" data-id="' + deposit.data._id + '"></td></tr>' +
                    '</table></div>';

          return panel;
        }

        function processNext() {
          //if (currentIndex == 0) {
            var points = $('#purchase-points').val();
              if ((points === "")) {
                swal("Points", "Please provide points", "error");
                return false;
              } else {
                //var usd = points * 1;
                //var actualUSD = usd + parseFloat(usd) * 0.01;
                //var bitcoinValue = 0.4123223;
                var cryptoType = $('#cryptoType').val();
                $('#deposit-crypto').html(cryptoType.toUpperCase() + " ");
                if (cryptoType == 'bitcoin') {
                  swal({ title: "Fetching Bitcoin Information", text: "Please wait.", imageUrl: loading, imageSize: '200x200', showConfirmButton: false});
                  //var bitcoinValue = 0.4123223;
                  var bitcoinValue = getBitcoinValue(points);

                  swal.close();

                  if (bitcoinValue === "") {
                    swal("Points", "Bitcoin network is busy please try again", "error");
                    return false;
                  } else {
                    $('#requested-points').html('$' + points);
                    $('#calculated-bitcoin-value').html(bitcoinValue);
                    $('#buy-bitcoin').val(bitcoinValue);
                    //$('#final-btc-value').html(bitcoinValue);
                    //$('#smartwizard').smartWizard("next");
                    return true;
                  }
                } else if (cryptoType == 'ethereum') {
                  swal({ title: "Fetching Ethereum Information", text: "Please wait.", imageUrl: loading, imageSize: '200x200', showConfirmButton: false});
                  //var bitcoinValue = 0.4123223;
                  var value = getEthereumValue(points);

                  swal.close();

                  if (value === "") {
                    swal("Points", "Bitcoin network is busy please try again", "error");
                    return false;
                  } else {
                    $('#requested-points').html('$' + points);
                    $('#calculated-bitcoin-value').html(value);
                    $('#buy-bitcoin').val(value);
                    //$('#final-btc-value').html(bitcoinValue);
                    //$('#smartwizard').smartWizard("next");
                    return true;
                  }
                } else if (cryptoType == 'usdt') {
                  swal({ title: "Fetching USDT Information", text: "Please wait.", imageUrl: loading, imageSize: '200x200', showConfirmButton: false});
                  //var bitcoinValue = 0.4123223;
                  var value = points;

                  swal.close();

                  if (value === "") {
                    swal("Points", "USDT network is busy please try again", "error");
                    return false;
                  } else {
                    $('#requested-points').html('$' + points);
                    $('#calculated-bitcoin-value').html(value);
                    $('#buy-bitcoin').val(value);
                    return true;
                  }
                }
                
              }
        }

        $(document.body).on('click', '#next-btn', function (e) {
            // Navigate next
        });


        // Demo Button Events
        $("#got_to_step").on("change", function() {
            // Go to step
            var step_index = $(this).val() - 1;
            $('#smartwizard').smartWizard("goToStep", step_index);
            return true;
        });

        $("#is_justified").on("click", function() {
            // Change Justify
            var options = {
              justified: $(this).prop("checked")
            };

            $('#smartwizard').smartWizard("setOptions", options);
            return true;
        });

        $("#dark_mode").on("click", function() {
            // Change dark mode
            var options = {
              darkMode: $(this).prop("checked")
            };

            $('#smartwizard').smartWizard("setOptions", options);
            return true;
        });

        $("#animation").on("change", function() {
            // Change theme
            var options = {
              transition: {
                  animation: $(this).val()
              },
            };
            $('#smartwizard').smartWizard("setOptions", options);
            return true;
        });

        $("#theme_selector").on("change", function() {
            // Change theme
            var options = {
              theme: $(this).val()
            };
            $('#smartwizard').smartWizard("setOptions", options);
            return true;
        });

        function getBitcoinValue(points) {
          return $.ajax({
            type: 'GET',
            url: "https://blockchain.info/tobtc?currency=USD&value=" + points,
            async: false
          }).responseText;
        }

        function getEthereumValue(points) {
          var result = $.ajax({
            type: 'GET',
            url: "https://api.coingecko.com/api/v3/simple/price?ids=ethereum&vs_currencies=USD",
            async: false
          }).responseText;

          var ethereumResponse = JSON.parse(result);
          //var value = points * (ethereumResponse.ethereum.usd);
          var value = 1.00000000 / ethereumResponse.ethereum.usd * points
          return value.toFixed(8);
        }

        function initiateBitcoinDeposit(cryptoType) {

          if (cryptoType == 'ethereum') {
            //var walletAddress = $('#btc-wallet-address').val();
            $('#bitcoin-address').val(ethWallet);
          } else if (cryptoType == 'usdt') {
            $('#bitcoin-address').val(usdtWallet);
          }
          var userName = $('#user-information').data("username");
          var userId = $('#user-information').data("userid");
          var btcWallet = $('#user-information').data("btcwallet");
          var url = "/rest/api/v1/points/buy/initiate";
            var data = {};
              data.userId = userId;
              data.userName = userName;
              data.address = btcWallet;
              data.addressType = cryptoType;
              data.value = parseFloat($('#buy-bitcoin').val());
              data.usd = parseFloat($('#purchase-points').val());
              data.points = parseFloat($('#purchase-points').val());
              data.address = $('#bitcoin-address').val();
              data.hash = 'Initiated';
          return $.ajax({
            url: url,
            data: JSON.stringify(data),
            type: 'POST',
            dataType: "json",
            contentType:"application/json",
            async: false
          }).responseText;

          //return "Success";
        }


      $(document.body).on('click', '#copy-btc-address', function (e) {
        var
          t = e.target,
          c = t.dataset.copytarget,
          inp = $('#btc-wallet-address');

        // is element selectable?
        if (inp && inp.select) {

          // select text
          inp.select();

          try {
            // copy text
            document.execCommand('copy');
            inp.blur();

            // copied animation
            //t.classList.add('copied');
            //setTimeout(function() { t.classList.remove('copied'); }, 1500);
            swal("Copied!", "Bitcoin address copied!!", "success");
          }
          catch (err) {
            //alert('please press Ctrl/Cmd+C to copy');
          }
        }
      });

      if ($('#blockchainIntiatedTbl')) {
          $('#blockchainIntiatedTbl').DataTable({
            responsive: true
          })
        }

        $('#secondStep').show();

    });
</script>
  <!-- END: page scripts -->
</div>