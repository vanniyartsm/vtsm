<div class="utils__content">

    <nav class="utils__top-sidebar utils__top-sidebar--bg">
        <span class="font-size-18 d-block mb-2"> <span class="text-muted">Admin Â·</span> <strong>PV Details</strong>
        </span>
    </nav>

    <div class="row">
        <div class="col-lg-12">
            <div class="card">
                <div class="card-body">
                    <div class="content-header row">
                        <div class="content-header-right text-md-right col-xs-12 mb-2">
                            <div class="btn-group">
                                <select id="accountTypeId" name="accountTypeId">
                                    <option value="1">Account</option>
                                    <option value="2">Earned Account</option>
                                    <option value="3">Offer Account</option>
                                </select>
                                <c:if test="${not empty accounts}">
                                    <select id="trade-account">
                                        <% if (accounts) {
                                            for (var i = 0; i < accounts.length; i++) {
                                                var account = accounts[i];
                                            %>
                                                <option value="<%= account._id %>"><%= account.accountName %></option>
                                        <% }
                                             } %>
                                        <option value="-1">All</option>
                                        <option value="0">Available Balance</option>
                                    </select>

                                    <select id="earned-account" style="display:none;">
                                        <c:forEach items="${accounts}" var="account" varStatus="loop">
                                            <c:if test="${(account.accountTypeId == 2)}">
                                                <option value="${account.accountId}">${account.accountName}</option>
                                            </c:if>
                                        </c:forEach>
                                        <option value="-1">All</option>
                                        <option value="0">Available Balance</option>
                                    </select>

                                    <select id="offer-account" style="display:none;">
                                        <c:forEach items="${accounts}" var="account" varStatus="loop">
                                            <c:if test="${(account.accountTypeId == 3)}">
                                                <option value="${account.accountId}">${account.accountName}</option>
                                            </c:if>
                                        </c:forEach>
                                        <option value="-1">All</option>
                                        <option value="0">Available Balance</option>
                                    </select>
                                </c:if>
                                <select name="condition">
                                    <option value=">=">>=</option>
                                </select>

                                <input type="number" id="withdrawalAmount" name="withdrawalAmount">
                            </div>
                            <button type="button" class="btn btn-sm btn-primary" id="pv-submit"
                                data-url="${context}/admin/totalpv">Submit</button>
                        </div>
                    </div>

                    <div id="total-pv-details">
                        <table class="table table-striped table-bordered base-style" id="totalpvs">
                            <thead>
                                <tr>
                                    <th>S NO</th>
                                    <th data-hide="phone,tablet">User Name</th>
                                    <th data-hide="phone,tablet">Login Id</th>
                                    <th data-hide="phone,tablet">Account</th>
                                    <th data-hide="phone,tablet">Total Pv</th>
                                    <th data-hide="phone,tablet">Date</th>
                                    <th data-hide="phone,tablet">Edit</th>
                                </tr>
                            </thead>
                            <tbody>
                                <c:forEach items="${totalPvs}" var="pv" varStatus="counter">
                                    <tr>
                                        <td>${counter.count}</td>
                                        <td>${pv.userName}</td>
                                        <td>${pv.loginId}</td>
                                        <td>${pv.accountId}</td>
                                        <td>${pv.totalPv}</td>
                                        <td>${pv.transactionDate}</td>
                                        <td>
                                            <a href="#" class="btn btn-sm side-panel-trigger slide-btn btn-warning mr-1"
                                                data-url="${context}/admin/user/info/${pv.loginId}"
                                                data-title="User Info" data-method="GET">Edit</a>
                                        </td>
                                    </tr>
                                </c:forEach>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<script>
    $(document).ready(function () {
        //$('#users').DataTable();
        $('#pv-submit').on('click', function (e) {
            console.info('clicked');
            var accountTypeId = $("#accountTypeId option:selected").val();
            var accountId;
            if (accountTypeId == 1) {
                accountId = $('#trade-account option:selected').val();
            } else if (accountTypeId == 2) {
                accountId = $('#earned-account option:selected').val();
            } else if (accountTypeId == 3) {
                accountId = $('#offer-account option:selected').val();
            }
            console.info('accountId = ', accountId);
            var withdrawalAmount = $('#withdrawalAmount').val();
            $('#total-pv-details').LoadingOverlay("show");
            var pvurl = $(this).data('url');
            pvurl += "/" + accountTypeId + "/" + withdrawalAmount + "/" + accountId;
            console.info('pvurl = ', pvurl);

            $.ajax({
                url: pvurl,
                type: 'GET',
                error: function (err) {
                    $('#total-pv-details').LoadingOverlay("hide");
                },
                success: function (data) {
                    $('#total-pv-details').html(data);
                    $('#total-pv-details').LoadingOverlay("hide");
                }
            });
        })

        $('#accountTypeId').on('change', function (e) {
            var accountTypeId = $(this).val();
            console.info('accountTypeId = ', accountTypeId);

            if (accountTypeId == 1) {
                $('#trade-account').show();
                $('#earned-account').hide();
                $('#offer-account').hide();
            } else if (accountTypeId == 2) {
                $('#earned-account').show();
                $('#trade-account').hide();
                $('#offer-account').hide();
            } else if (accountTypeId == 3) {
                $('#offer-account').show();
                $('#trade-account').hide();
                $('#earned-account').hide();
            }
        });
    });
</script>
<script>
    $(document).ready(function () {
        $('#totalpvs').DataTable();
    });
</script>